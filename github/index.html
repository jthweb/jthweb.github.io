<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <title>JThweb · GitHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        :root { --primary: #0078d4; --bg-primary:#fff; --text-primary:#242424; --border-color:#e1e1e1; --bg-secondary:#f5f5f5; --text-secondary:#616161; --shadow-color: rgba(0,0,0,0.1);} 
        html.dark { --primary: #2899f5; --bg-primary:#121212; --text-primary:#f5f5f5; --bg-secondary:#1e1e1e; --text-secondary:#a0a0a0; --border-color:#333333; --shadow-color: rgba(0,0,0,0.4);} 
        body { font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background-color:var(--bg-primary); color:var(--text-primary); }
        .section-card { background-color:var(--bg-secondary); border:1px solid var(--border-color); border-radius:12px; padding:2rem; box-shadow:0 4px 20px var(--shadow-color);} 
        .github-stats-img { border-radius:8px; border:1px solid var(--border-color); width:100%; height:auto; object-fit:cover; background-color:var(--bg-secondary);} 
        a.animated { transition: all 0.15s ease; }
    </style>
</head>
<body>
    <header class="py-6 border-b" style="border-color:var(--border-color); background:color-mix(in srgb, var(--bg-primary) 80%, transparent);">
        <div class="container mx-auto px-4 flex items-center justify-between">
            <a href="/" class="flex items-center gap-3"><img src="/logo.gif" alt="logo" class="w-10 h-10 rounded-full"><span class="font-bold">JThweb</span></a>
            <nav class="flex items-center gap-4">
                <a href="/" class="text-sm hover:text-[var(--primary)]">Home</a>
                <a href="/github" class="text-sm font-semibold hover:text-[var(--primary)]">GitHub</a>
                <a href="mailto:jthweb@duck.com" class="text-sm hover:text-[var(--primary)]">Contact</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <section class="my-12 text-center">
            <h1 class="text-3xl font-bold mb-4">GitHub · Stats & Repositories</h1>
            <p class="text-lg text-[var(--text-secondary)] max-w-2xl mx-auto mb-6">This page contains the live GitHub stats, contributions graph, and an interactive list of repositories you can star from the site.</p>
        </section>

        <section class="my-8">
            <div class="section-card max-w-5xl mx-auto">
                <h2 class="text-2xl font-bold mb-6">GitHub Stats</h2>
                <div class="space-y-6">
                    <img id="github-contributions" src="" alt="Contributions" class="github-stats-img w-full" />
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <img id="github-stats-card" src="" alt="GitHub Stats" class="github-stats-img" />
                        <img id="github-streak-stats" src="" alt="Streak Stats" class="github-stats-img" />
                    </div>
                </div>
            </div>
        </section>

        <section class="my-8">
            <div class="section-card max-w-7xl mx-auto">
                <h2 class="text-2xl font-bold mb-4">Repositories</h2>
                <p class="text-[var(--text-secondary)] mb-6">Featured repositories from my GitHub account. Use the Star button to star a repo via the site bot.</p>
                <p id="project-count-display" class="text-sm mb-4 text-[var(--text-secondary)]">Showing 8 of <span id="total-repo-count" class="font-semibold">--</span> repositories.</p>
                <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
        </section>
    </main>

    <footer class="text-center py-8" style="color: var(--text-secondary);">
        <p>Copyleft © 2026 JThweb.</p>
    </footer>

    <script>
        const GITHUB_CLIENT_ID = 'Ov23liSLmQfrm4aBKuMk';
        const GITHUB_USERNAME = 'jthweb';
        const PROXY_URL = 'https://github-oauth-proxy-server.vercel.app/api/auth';

        function redirectToProxy(action, repo = null) {
            let proxyUrl = `${PROXY_URL}?action=${action}`;
            if (repo) proxyUrl += `&repo=${encodeURIComponent(repo)}`;
            const authWindow = window.open(proxyUrl, 'githubAuth', 'width=600,height=700,scrollbars=yes');
            const checkWindow = setInterval(() => {
                if (!authWindow || authWindow.closed) {
                    clearInterval(checkWindow);
                    fetchGitHubData();
                }
            }, 500);
        }

        function handleFollow() { redirectToProxy('follow'); }
        function handleStar(repoName) { redirectToProxy('star', repoName); }
        function handleFollowAndStarAll() { redirectToProxy('follow_and_star_all'); }

        async function fetchGitHubData() {
            try {
                const response = await fetch(`https://api.github.com/users/${GITHUB_USERNAME}/repos?sort=updated&per_page=100`);
                if (!response.ok) throw new Error('Network response was not ok.');
                const repos = await response.json();
                const originalRepos = repos.filter(repo => !repo.fork && repo.name.toLowerCase() !== 'new');
                const totalStars = originalRepos.reduce((acc, repo) => acc + repo.stargazers_count, 0);
                document.getElementById('total-repo-count').textContent = originalRepos.length;
                const projectsGrid = document.getElementById('projects-grid');
                projectsGrid.innerHTML = '';
                const featuredRepos = originalRepos.slice(0, 8);
                featuredRepos.forEach(repo => {
                    const card = document.createElement('div');
                    card.className = 'section-card';
                    card.innerHTML = `
                        <h3 class="font-bold mb-2">${repo.name}</h3>
                        <p class="text-sm mb-4 text-[var(--text-secondary)]">${repo.description || 'No description available.'}</p>
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-[var(--text-secondary)]">
                                ⭐ ${repo.stargazers_count} &nbsp; • &nbsp; Forks: ${repo.forks_count}
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="handleStar('${repo.full_name}')" class="px-3 py-1.5 rounded-lg font-semibold animated-button secondary text-xs">⭐ Star</button>
                                <a href="${repo.html_url}" target="_blank" rel="noopener noreferrer" class="px-3 py-1.5 rounded-lg font-semibold animated-button secondary text-xs">View</a>
                            </div>
                        </div>`;
                    projectsGrid.appendChild(card);
                });
            } catch (err) {
                console.error('Failed to fetch GitHub data', err);
                document.getElementById('projects-grid').innerHTML = '<p>Could not load projects.</p>';
            }
        }

        function setGitHubStatsImages() {
            const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const themeQuery = `&theme=${theme === 'dark' ? 'dark' : 'default'}`;
            const base = 'https://github-readme-stats.vercel.app/api';
            document.getElementById('github-stats-card').src = `${base}?username=${GITHUB_USERNAME}&show_icons=true${themeQuery}`;
            document.getElementById('github-streak-stats').src = `${base}/streak-stats?username=${GITHUB_USERNAME}${themeQuery}`;
            document.getElementById('github-contributions').src = `https://github.com/JThweb/JThweb/raw/output/github-contribution-grid-snake.svg`;
        }

        window.addEventListener('load', () => {
            fetchGitHubData();
            setGitHubStatsImages();
            setInterval(fetchGitHubData, 300000);
        });
    </script>
</body>
</html>